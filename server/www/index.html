

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="stylesheets/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="components/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/masonry/3.2.2/masonry.pkgd.min.js"></script>

  <link rel="stylesheet" href="components/glyphicons/glyphicons.css">

  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
</head>
<body>

  <header id="global-header">
    <h1><img src="images/brand.png" alt="Unterest" height="48"></h1>
  </header>

  <header id="mainvisual" class="keyVisual fullHeight">
    <div class="indicator" id="toilet-count">
      <span class="counter"></span> <img src="images/tmark.svg" alt="" class="mark">
    </div>
    <div class="visual streetview">
      <img src="http://maps.googleapis.com/maps/api/streetview?size=960x480&location=35.666087999999995,139.73195339999998&heading=235&sensor=false">
    </div>

    <a href="#" class="buttonCommon lighten mainvisualCenter">
      <div class="first"><span class="glyphicons fire">トイレ貸してください！</span></div>
      <div class="second"><span class="glyphicons undo"></span></div>
    </a>
  </header>


  <section id="entrance">
    <div class="lowerComponents">
      <button class="lighten" ><span class="glyphicons compass"></span>位置情報を送信して開始</button>
      <img src="images/loader.gif" alt="" class="progress">
    </div>
  </section>

  <script>


  var Geokit = function(callback){
    this.status = undefined;
    this.result = false;
    return false;
  }


  Geokit.prototype.done = function(pos){
     this.status = "success";
     console.log(this.status , this);
     console.log("done:",pos,status);
     this.result = pos;
  }

  Geokit.prototype.fail = function(a){
     this.status = false;
  }


  Geokit.prototype.get = function(callback){
    navigator.geolocation.getCurrentPosition(
      function(pos){
        geolocation.done(pos);
        callback.call(this);
      },
      function(pos){
        geolocation.fail(pos);
      });
  }


  var geolocation = new Geokit();



    $(function(){

      var $entrance = $("#entrance");
      $entrance.find("button").on({"click":function(){
        $entrance.addClass("progress");
        geolocation.get(function(){
          $entrance.fadeOut();
        });
      }});

      $(window).on({"resize":function(){
        var fullHeight = $(window).height() - $("#global-header").height() - $("#global-footer").height();
        console.log(fullHeight);
        $("#mainvisual.fullHeight").height(fullHeight)
      }}).trigger("resize");

      $(".buttonCommon").on({"click":function(){
        $("#mainvisual.fullHeight").height("").removeClass("fullHeight")
        $(this).removeClass("mainvisualCenter");
      }});

    });


  </script>


  <section>
    <ul id="main-cards" class="cards searchresult" style="display:none;">
      <li class="fullsize">
        <div class="card">
          <span class="glyphicons more"></span> 999m
        </div>
      </li>
      <li class="fullsize">
        <div class="card">
          <span class="glyphicons more"></span> 999m
        </div>
      </li>
      <li class="fullsize">
        <div class="card">
          <span class="glyphicons more"></span> 999m
        </div>
      </li>
      <li class="fullsize">
        <div class="card">
          <span class="glyphicons more"></span> 999m
        </div>
      </li>
      <li class="fullsize">
        <div class="card">
          <span class="glyphicons more"></span> 999m
        </div>
      </li>


    </ul>
  </section>

  <script>

    function setStatus($el,status){
      $el.removeClass("deny allow");
      $icon =$el.find(".glyphicons");

      $icon.removeClass("mode remove ok");
      if(status == "allow"){
        $el.addClass("allow");
        $icon.addClass("ok");
      }else if(status == "deny"){
        $el.addClass("deny");
        $icon.addClass("remove");
      }else{
        $icon.addClass("more");
      }
    }

    $("#main-cards").children("li").each(function(){

      var table = ["allow","deny",false];
      var sleep = (Math.floor(Math.random()*10000)+2000);


      var $el = $(this)

      var select = Math.floor(Math.random()*3);

      console.log(sleep,select)

      setTimeout(function(){
        setStatus($el,table[select]);
        console.log('Yo')

      },sleep);

    })


  </script>


  <footer id="global-footer">
    <img src="images/kirinsanorg.svg" height="32" alt="">
  </footer>


<script>



$(window).on(
  {
    "scroll":function(){

      $(".visual.streetview img").css("marginTop",(function(){

        return ($(this).scrollTop() / $(window).height() * 30) - 15 + "%"

      })());

    }

});


</script>


</body>
</html>
